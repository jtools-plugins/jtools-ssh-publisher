# SSH Publisher

[![JetBrains Plugin](https://img.shields.io/badge/JetBrains-Plugin-orange)](https://plugins.jetbrains.com/)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)

IntelliJ IDEA SSH 客户端插件，集成终端、文件浏览器和批量上传功能。

## ✨ 功能特性
![1](./images/1.png)
![2](./images/2.png)
### 🔐 SSH 连接管理
- 密码和密钥两种认证方式
- 支持使用本地默认密钥（~/.ssh/id_rsa）
- 支持从文件选择器加载任意密钥文件（PEM/二进制格式）
- 连接测试
- 心跳保活，防止超时断开
- **前置/后置脚本配置**（列表+编辑器方式，方便编辑）
- **非模态编辑对话框**（编辑时可同时进行其他操作）
- **配置导出/导入**（支持全部导出或选择性导出）

### 💻 SSH 终端
- 基于 JediTerm 的专业终端模拟器
- 自动适配 IDEA 明暗主题
- 完善的中文字体支持
- 多终端标签页管理
- **Tab 拖拽排序**
- **跨分屏容器 Tab 拖拽移动**（支持指定位置插入）
- **Tab 右键分屏**（向右拆分 / 向下拆分 / 取消分屏）
- **无限层级分屏**
- **基于焦点添加新 Tab**（点击或聚焦某个分屏容器后，新建的终端/文件系统会添加到该容器）
- 拖拽时目标容器高亮提示
- 分屏容器内所有 Tab 关闭后自动合并
- **底部系统监控状态栏**（CPU/内存/磁盘/进程数，每5秒刷新）

### 📁 文件浏览器 (SFTP)
- 远程文件系统浏览
- 文件/文件夹上传下载（**实时进度显示**）
- 新建文件夹、**新建文件**
- 重命名、删除
- **双击文件在 IDEA 编辑器中打开编辑**
- **保存时自动同步到远程服务器**（带通知提示）
- **连接断开时自动重连后同步**
- **支持 IDEA 本地历史记录（Local History）**
- 文件属性查看（大小、权限、修改时间）
- 快速搜索定位文件
- 懒加载目录（展开时加载，提升性能）
- **下载文件时检测重名**（支持覆盖/重命名/取消）
- **关闭文件系统 Tab 时自动关闭所有打开的远程文件编辑器**
- **底部系统监控状态栏**（CPU/内存/磁盘/进程数，每5秒刷新）

### 📤 传输管理
- **统一管理上传和下载任务**
- **每个任务使用独立 SSH 连接**（不影响终端和文件系统）
- 任务队列管理（进度显示、停止、重试、删除）
- **停止上传任务时自动删除远程未完成文件**
- **停止下载任务时自动删除本地未完成文件**
- **任务详情查看**（前置脚本、后置脚本、执行日志）
- 批量停止、清除已完成任务

### 📤 批量上传
- **多文件上传到多台服务器**
- **每个文件独立配置目标服务器**
- **每个文件独立配置远程路径和文件名**
- **每个文件独立配置前置/后置脚本**
- 上传队列管理（进度、停止、重试、删除）
- 自定义远程文件名（解决中文乱码）
- 临时脚本支持（一次性执行）

### 📋 上传模板
- **保存常用上传任务为模板，一键执行**
- **分组管理模板**
- 配置本地文件、目标服务器、远程路径
- 支持自定义远程文件名
- **支持选择服务器已配置的前置/后置脚本**
- **支持临时脚本（仅本次执行）**
- 双击模板快速执行
- **支持多选批量执行**
- 模板复制、编辑、删除
- **导出/导入时包含模板配置**

### ⚙️ 配置管理
- **导出配置**（全部导出或选择性导出）
- **导入配置**（支持覆盖或跳过已存在配置）
- **刷新后保持展开状态**

## 📸 界面预览

```
┌─────────────────────────────────────────────────────┐
│ [+新建] [↑批量上传] [↻刷新] [展开] [折叠] [导出] [导入] │
├───────────────┬─────────────────────────────────────┤
│               │                                     │
│  📁 SSH连接   │   🖥️ 终端 / 📂 文件系统              │
│  ├─ 生产环境  │                                     │
│  │  └─ web-1  │   ┌─────────┬─────────┐            │
│  │  └─ web-2  │   │ Tab 1   │ Tab 2   │  ← 支持分屏 │
│  └─ 测试环境  │   ├─────────┴─────────┤            │
│     └─ test   │   │                   │            │
│               │   │                   │            │
│  📋 上传模板  │   │                   │            │
│  └─ 模板列表  │   │                   │            │
│               │   │                   │            │
│  📤 传输管理  │   └───────────────────┘            │
│  └─ 任务列表  │                                     │
└───────────────┴─────────────────────────────────────┘
```

## 🚀 快速开始

### 添加 SSH 连接
1. 点击工具栏 **[+]** 按钮
2. 填写连接信息（名称、主机、端口、用户名）
3. 选择认证方式：
   - **密码认证**：输入密码
   - **密钥认证**：粘贴私钥内容
4. 点击「测试连接」验证
5. 保存配置

### 使用终端
- **双击** SSH 配置打开终端
- **右键 Tab** → 向右拆分 / 向下拆分 / 取消分屏
- **拖拽 Tab** 调整顺序或移动到其他分屏容器
- **点击或聚焦** 某个分屏容器后，新建的终端会添加到该容器

### 使用文件浏览器
- **右键** SSH 配置 → 文件系统
- **双击** 目录进入
- **双击** 文件在 IDEA 编辑器中打开（保存自动同步）
- **工具栏** 上传/下载/新建文件夹/新建文件

### 下载文件
- **右键** 文件 → 下载
- 或选中文件点击工具栏 **[下载]** 按钮
- 本地存在同名文件时可选择：覆盖 / 重命名 / 取消
- 任务添加到「传输管理」队列

### 传输管理
- 查看所有上传/下载任务进度
- **停止**：中断任务并清理未完成文件
- **重试**：重新执行失败或已停止的任务
- **删除**：从列表移除任务
- **详情**：查看脚本内容和执行日志

### 批量上传
1. 点击工具栏 **[批量上传]**
2. 添加要上传的文件（支持多选）
3. 选择每个文件的目标服务器
4. 配置每个文件的远程路径和文件名
5. 点击服务器配置脚本（可选）
6. 设置临时脚本（可选）
7. 添加到传输队列
8. 在「传输管理」查看进度

### 上传模板
1. 切换到左侧 **[上传模板]** Tab
2. 点击 **[+]** 新建模板
3. 填写模板名称、分组
4. 选择本地文件
5. 选择目标服务器
6. 配置远程路径和文件名（可选）
7. 选择服务器脚本或编写临时脚本（可选）
8. 保存模板
9. **双击** 模板执行，或 **多选后点击「执行选中」** 批量执行

### 导出配置
1. 点击工具栏 **[导出配置]**
2. 选择「导出全部」或「选择导出」
3. 选择导出目录
4. 配置导出为 JSON 文件

### 导入配置
1. 点击工具栏 **[导入配置]**
2. 选择配置文件（JSON）
3. 选择覆盖或跳过已存在的配置

## 💾 数据存储

配置数据使用 SQLite 存储：
```
~/.jtools/jtools-ssh-publisher/db.data
```

远程文件编辑缓存：
```
~/.jtools/jtools-ssh-publisher/{config-id}/...
```

## 🔧 构建

```bash
# 构建插件
./gradlew buildPlugin

# 产物位置
build/distributions/JTools-SSH-Publisher-*.zip
```

## 📦 安装

1. 打开 IDEA → Settings → Plugins
2. 点击 ⚙️ → Install Plugin from Disk...
3. 选择构建的 zip 文件
4. 重启 IDEA

## 📋 依赖

| 依赖 | 用途 |
|------|------|
| Apache MINA SSHD | SSH/SFTP 客户端 |
| SQLite JDBC | 数据存储 |
| JediTerm | 终端模拟 |

## 📝 更新日志

### v1.1.9
- 新增：上传模板功能（保存常用上传任务为模板，一键执行）
- 新增：模板分组管理
- 新增：模板支持选择服务器脚本和临时脚本
- 新增：模板支持多选批量执行
- 新增：导出/导入时包含模板配置

### v1.1.8
- 新增：配置导出/导入功能（支持全部导出或选择性导出）
- 新增：批量上传增强（多文件独立配置目标服务器、远程路径和脚本）
- 优化：SSH连接编辑对话框改为非模态
- 优化：前置/后置脚本编辑改为列表+编辑器方式
- 优化：刷新SSH连接列表时保持展开状态
- 修复：全部展开/全部收起按钮功能
- 修复：上传任务添加成功提示不显示的问题
- 修复：关闭插件窗口后重新打开，传输任务无法执行的问题

### v1.1.7
- 新增：跨分屏容器 Tab 拖拽移动
- 新增：跨容器拖拽支持指定位置插入
- 新增：拖拽时目标容器高亮提示
- 新增：基于焦点确定新 Tab 添加位置

### v1.1.6
- 新增：系统监控状态栏（CPU/内存/磁盘/进程数）
- 新增：支持使用本地默认密钥（~/.ssh/id_rsa）
- 新增：支持从文件选择器加载任意密钥文件

### v1.1.5
- 新增：传输管理（统一管理上传和下载任务）
- 新增：任务详情查看（脚本和日志）
- 新增：下载文件重名检测

### v1.1.4
- 新增：双击远程文件在 IDEA 编辑器中打开编辑
- 新增：保存后自动同步到远程服务器
- 新增：支持 IDEA 本地历史记录

## 📄 License

[Apache2.0 License](./LICENSE)

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

![微信](./images/wx.jpg)
